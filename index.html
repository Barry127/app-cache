<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="robots" content="index,follow">
  <meta name="googlebot" content="index,follow">
  <title>AppCache</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/5.0.0/normalize.css" />
  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.7.0/styles/monokai-sublime.min.css">
  <link rel="stylesheet" type="text/css" href="styles.css">
</head>
<body>
  <header>
    <div class="container">
      <h1><small><i class="fa fa-fw fa-database"></i></small>App<span>Cache</span></h1>
    </div>
  </header>

  <div class="main container">
    <nav>
      <ul>
        <li>
          <a class="active" href="#introduction">Introduction</a>
        </li>
        <li>
          <a href="#gettingStarted">Getting Stared</a>
          <ul class="sub">
            <li><a href="#installation">Installatation</a></li>
            <li><a href="#example">Example</a></li>
            <li><a href="#testing">Testing</a></li>
          </ul>
        </li>
        <li>
          <a href="#appCache">AppCache</a>
          <ul class="sub">
            <li><a href="#create">create</a></li>
            <li><a href="#delete">delete</a></li>
            <li><a href="#get">get</a></li>
            <li><a href="#getOptions">getOptions</a></li>
            <li><a href="#set">set</a></li>
          </ul>
        </li>
        <li>
          <a href="#advanced">Advanced Topics</a>
          <ul class="sub">
            <li><a href="#events">Events</a></li>
            <li><a href="#mutability">Mutability</a></li>
            <li><a href="#readOnly">Read Only</a></li>
            <li><a href="#validators">Validators</a></li>
          </ul>
        </li>
        <li>
          <a href="#lisence">Lisence</a>
        </li>
      </ul>
    </nav>
    <main>
      <h1 id="introduction">Introduction</h1>
      <p>
        <a href="https://snyk.io/test/github/barry127/app-cache"><img src="https://snyk.io/test/github/barry127/app-cache/badge.svg" alt="Known Vulnerabilities" data-canonical-src="https://snyk.io/test/github/barry127/app-cache"></a>
        <a href="https://codeclimate.com/github/Barry127/app-cache"><img src="https://codeclimate.com/github/Barry127/app-cache/badges/gpa.svg" /></a>
        <a href="https://codeclimate.com/github/Barry127/app-cache/coverage"><img src="https://codeclimate.com/github/Barry127/app-cache/badges/coverage.svg" /></a>
      </p>
      <p>AppCache is a simple in memory key-value cache for global state in Node apps. AppCache takes away some of the pain of managing this data yourself by enforcing immutability on objects (AppCache clones object on get and set by default), read only setting and validators.</p>
      <p>AppCache is no replacement for datastores like Redis or Memcached but can be used for things like:</p>
      <ul>
        <li>Storing a password entered in stdin</li>
        <li>Storing an average, total, min or max value of a database column for quick calculations on new inserts</li>
        <li>Storing bits of data that where other parts of the app needs to be notified when it updates</li>
      </ul>

      <h1 id="gettingStarted">Getting Started</h1>

      <h2 id="installation">Installation</h2>
      <p>Installing AppCache can be done using npm.</p>
      <pre><code class="bash">npm install --save app-cache</code></pre>
      <p>After installation AppCache can be included in your project. Since AppCache is a singleton it does not need to be instantiated using the <code>new</code> keyword.</p>
      <pre><code class="javascript">const appCache = require('app-cache');

appCache.create('myValue', 'fooBar', {
  readOnly: true
});

console.log(appCache.get('myValue')); // => fooBar

/* readOnly values cannot be set */
appCache.set('myValue', 'baz'); // => Throws a TypeError</code></pre>

      <h2 id="example">Example</h2>
      <p>In the next example we use AppCache to keep track of the maximum value of the column <code>myCol</code> in a database table. The model needs the max value to create a calculated value on update or create. We also want to notify the connected clients when this value changes.</p>
      <pre><code class="javascript">const appCache = require('app-cache');

// First we create a maxValue key
// If a key is not created the set method will create the key first
appCache.create('maxValue', 0);

// Get max value from database with a fictional ORM
myModel.getAll(function (err, rows) {
  appCache.set('maxValue', rows.reduce(function (max, value) {
    if (max > value.myCol) {
    return max;
    }
    return value.myCol
  }, 0));
});

// When maxValue changes send the value to the connected clients
appCache.on('set', function (key, value) {
  if (key === 'maxValue') {
    // Send max value to all clients
    sockets.send('maxValue', value);
  }
});

// fictional ORM entry update method
myModal.onUpdate(function () {
  if (this.myCol > appCache.get('maxValue')) {
    appCache.set('maxValue', this.myCol);
  }
  this.computedValue = appCache.get('maxValue') / 4;
});

</code></pre>

      <h2 id="testing">Testing</h2>
      <p>AppCache comes with a complete test suite. Just clone the repo from github the run all tests.</p>
      <pre><code class="bash">git clone https://github.com/Barry127/app-cache.git
cd app-cache
npm install
npm run test</code></pre>

      <h1 id="appCache">AppCache</h1>
      <h2 id="create">Create</h2>
      <p><code>appCache.create(key, [value], [options]) : &lt;<strong>Object</strong>&gt;appCache </code></p>
      <p>Create a key for the store. Throws <code>AppCacheKeyError</code> if key already exists.</p>
      <h4>Arguments</h4>
      <table>
        <tbody>
          <tr>
            <td>
              <strong>key</strong>
              <small>String</small>
            </td>
            <td>Key property name to create.</td>
          </tr>
          <tr>
            <td>
              <strong>value</strong>
              <small>*</small>
            </td>
            <td>Initial value.</td>
          </tr>
          <tr>
            <td>
              <strong>options</strong>
              <small>Object | Boolean</small>
            </td>
            <td>Options for this key, see options below. If value is a boolean the value will be set to <code>readOnly</code>.</td>
          </tr>
        </tbody>
      </table>
      <h4>Options</h4>
      <table>
        <tbody>
          <tr>
            <td>
              <strong>mutable</strong>
              <small>Boolean</small>
            </td>
            <td>
              Are Object values mutable? If true the value is set by reference instead of a deep clone. Default value: <code>false</code>
            </td>
          </tr>
          <tr>
            <td>
              <strong>readOnly</strong>
              <small>Boolean</small>
            </td>
            <td>
              Is the value read only? If true the value cannot be changed using the <code>set</code> method. Default value: <code>false</code>
            </td>
          </tr>
          <tr>
            <td>
              <strong>validator</strong>
              <small>Function</small>
            </td>
            <td>
              Validate function which takes 1 argument the new value. If this function returns <code>true</code> the value will be set else the new value will be ignored. Default value: <code>() => true</code>
            </td>
          </tr>
        </tbody>
      </table>

      <h2 id="delete">Delete</h2>
      <p><code>appCache.delete(key) : &lt;<strong>Object</strong>&gt;appCache </code></p>
      <p>Delete a key from the store.</p>
      <table>
        <tbody>
          <tr>
            <td>
              <strong>key</strong>
              <small>String</small>
            </td>
            <td>Key property name to delete.</td>
          </tr>
        </tbody>
      </table>

      <h2 id="get">Get</h2>
      <p><code>appCache.get(key) : &lt;<strong>Any</strong>&gt;value </code></p>
      <p>Get a value by key from the store.</p>
      <table>
        <tbody>
          <tr>
            <td>
              <strong>key</strong>
              <small>String</small>
            </td>
            <td>Key property name to get value from. If key does not exist <code>undefined</code> will be returned.</td>
          </tr>
        </tbody>
      </table>

      <h2 id="getOptions">getOptions</h2>
      <p><code>appCache.getOptions(key) : &lt;<strong>Object</strong>&gt;options </code></p>
      <p>Get a clone of the the options by key from the store.</p>
      <table>
        <tbody>
          <tr>
            <td>
              <strong>key</strong>
              <small>String</small>
            </td>
            <td>Key property name to get options from. If key does not exist <code>null</code> will be returned.</td>
          </tr>
        </tbody>
      </table>

      <h2 id="set">Set</h2>
      <p><code>appCache.set(key, value) : &lt;<strong>Object</strong>&gt;appCache </code></p>
      <p>Set a value to key to the store. If the key does not exist <code>create</code> will be called with the default options. Throws a <code>TypeError</code> if the key has the options <code>readOnly</code> set to <code>true</code>.</p>
      <table>
        <tbody>
          <tr>
            <td>
              <strong>key</strong>
              <small>String</small>
            </td>
            <td>Key property name to set value to.</td>
          </tr>
          <tr>
            <td>
              <strong>value</strong>
              <small>*</small>
            </td>
            <td>Value to set.</td>
          </tr>
        </tbody>
      </table>

      <h1 id="advanced">Advanced Topics</h1>
      <h2 id="events">Events</h2>
      <p>AppCache extends the NodeJS <code>EventEmitter</code>. It emits events for all the methods.</p>
      <h4>Event Signatures</h4>
      <table>
        <tbody>
          <tr>
            <td>
              <strong>create</strong>
            </td>
            <td>
              function (key, value)
            </td>
          </tr>
          <tr>
            <td>
              <strong>delete</strong>
            </td>
            <td>
              function (key)
            </td>
          </tr>
          <tr>
            <td>
              <strong>get</strong>
            </td>
            <td>
              function (key, value)
            </td>
          </tr>
          <tr>
            <td>
              <strong>getOptions</strong>
            </td>
            <td>
              function (key, options)
            </td>
          </tr>
          <tr>
            <td>
              <strong>set</strong>
            </td>
            <td>
              function (key, newValue)
            </td>
          </tr>
        </tbody>
      </table>

      <h2 id="mutability">Mutability</h2>
      <p>AppCache will deep clone all Object values by default. This prevents unwanted changes in the store:</p>
      <pre><code class="javascript">const appCache = require('app-cache');
var testObject = {
  foo: 'bar'
};

appCache.create('myObj');
appCache.set('myObj', testObject);

// appCache creates new deep cloned objects by default
console.log(appCache.get('myObj') === testObject) // => false

// This does not affect the stored value
testObject.bar = 'baz';
console.log(appCache.get('myObj').bar) // => undefined
</code></pre>

    <p>Sometimes you might want to store objects by reference instead of a deep clone of the value. In that case set the <code>mutable</code> option to <code>true</code>.</p>
    <pre><code class="javascript">const appCache = require('app-cache');
var user = {
  name: 'John',
  lastName: 'Doe'
};

appCache.create('myUser', user, { mutable: true });

// The value will be stored by reference
console.log(appCache.get('myUser') === user) // => true

user.name = 'Jane';
console.log(appCache.get('myUser').name) // => "Jane";
</code></pre>

      <div class="message warning">
        <div class="icon"><i class="fa fa-exclamation-triangle"></i></div>
        <div class="content">
          <h3>Warning!</h3>
          <p>Using mutable objects might lead to unexpected bugs or state.</p>
          <ul>
            <li>You can't be sure if a property is changed somewhere else in your App.</li>
            <li>AppCache will not emit events if a mutable Object is changed.</li>
            <li>Mutable objects can't be readOnly for sure because they can be changed without the <code>set</code> method.</li>
          </ul>
        </div>
      </div>

      <h2 id="readOnly">Read Only</h2>
      <p>There might be cases when a value only needs to be set once and cannot be changed afterwards. The <code>ReadOnly</code> setting can be used for this.</p>
      <pre><code class="javascript">const appCache = require('app-cache');
// We want to keep track of when the API_KEY is used so we store it in our store.
appCache.create('myApiKey', process.env.API_KEY, { readOnly: true });

appCache.on('get', function (key) {
  if (key === 'myApiKey') {
    // API_KEY is used
  }
});

// Try to set a new value to myApiKey
appCache.set('myApiKey', 'XXX'); // => Throws a TypeError
      </code></pre>

      <div class="message info">
        <div class="icon"><i class="fa fa-info-circle"></i></div>
        <div class="content">
          <h3>Deleting Read Only values</h3>
          <p>Although Read Only values cannot be changed after they are created, the can be deleted.</p>
          <p>If you need to make sure a key is not deleted and recreated with a different value keep track of the delete event for the specific key and throw an Error if the key is deleted.</p>
        </div>
      </div>

      <h2 id="validators">Validators</h2>
      <p>AppCache allows to validate a value before it is set by setting a function to the <code>validate</code> option.</p>
      <pre><code class="javascript">const appCache = require('app-cache');

AppCache.create('aNumber', 0, {
  validate: function (newValue) {
    if (typeof newValue !== 'number') {
      return false;
    }
    if (Number.isNaN(newValue)) {
      return false;
    }
    return true;
  }
});

appCache.set('aNumber', 42);
console.log(appCache.get('aNumber')); // => 42

appCache.set('aNumber', Math.pow(-1)); // Math.pow(-1) === NaN
console.log(appCache.get('aNumber')) // => 42

appCache.set('aNumber', 2 + 5);
console.log(appCache.get('aNumber')) // => 7

appCache.set('aNumber', 'twelve');
console.log(appCache.get('aNumber')) // => 7
      </code></pre>

      <p>Keep the following things in mind when using validators:</p>
      <ul>
        <li>The initial value in the create method will not be validated.</li>
        <li>If a value is valid the function must explicitly return <code>true</code> otherwise the value will be flagged invalid.</li>
        <li>When a value is invalid there will be no <code>set</code> event emitted.</li>
      </ul>

      <h1 id="lisence">Lisence</h1>
      <p>MIT License</p>
      <p>Copyright (c) 2017 Barry de Kleijn</p>
      <p>Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:</p>
      <p>The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.</p>
      <p>THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.</p>
    </main>
  </div>

  <a href="https://github.com/Barry127/app-cache" class="github-corner" aria-label="View source on Github"><svg width="70" height="70" viewBox="0 0 250 250" style="fill:#1ed760; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
  <script src="https://code.jquery.com/jquery-2.2.4.min.js" integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.7.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>
  <script src="script.js"></script>
</body>
</html>